generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model User {
  id           String        @id @default(cuid())
  email        String        @unique
  name         String?
  clerkUserId  String        @unique
  createdAt    DateTime      @default(now())
  updatedAt    DateTime      @updatedAt
  role         Role          @default(USER)
  appointments Appointment[]
  vehicles     Vehicle[]
}

model Vehicle {
  id           String        @id @default(cuid())
  make         String
  model        String
  year         Int
  vin          String?       @unique
  ownerId      String
  createdAt    DateTime      @default(now())
  updatedAt    DateTime      @updatedAt
  color        String?
  fuelType     String?
  licensePlate String?       @unique
  mileage      Int?
  transmission String?
  appointments Appointment[]
  owner        User          @relation(fields: [ownerId], references: [id])

  @@index([make])
  @@index([licensePlate])
  @@map("vehicles")
}

model Service {
  id               String        @id @default(cuid())
  name             String
  description      String
  duration         Int
  price            Float

  isActive         Boolean       @default(true)
  requiresBooking  Boolean       @default(true)
  minAdvanceHours  Int?
  maxDailySlots    Int?

  category         ServiceCategory
  serviceType      ServiceType
  vehicleTypes     VehicleType[]

  laborHours       Float?
  laborRate        Float?

  isTaxable        Boolean       @default(true)
  discountable     Boolean       @default(true)

  requiredSkillLevel SkillLevel?
  visibility       ServiceVisibility @default(PUBLIC)

  warrantyDays     Int?
  followUpAfterDays Int?

  tags             String[]
  notes            String?

  serviceParts     ServicePart[]
  appointments     Appointment[]

  createdAt        DateTime      @default(now())
  updatedAt        DateTime      @updatedAt

  @@map("services")
}

enum ServiceCategory {
  MAINTENANCE
  REPAIR
  INSPECTION
  DIAGNOSTIC
  BODYWORK
  CUSTOMIZATION
  OTHER
}

enum ServiceType {
  FIXED
  VARIABLE
}


enum SkillLevel {
  BASIC
  INTERMEDIATE
  ADVANCED
  MASTER
}

enum ServiceVisibility {
  PUBLIC
  INTERNAL
  ADMIN_ONLY
}

enum VehicleType {
  SEDAN
  SUV
  TRUCK
  VAN
  MOTORCYCLE
}

model Appointment {
  id        String   @id @default(cuid())
  date      DateTime
  status    String   @default("PENDING")
  userId    String
  vehicleId String
  serviceId String
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
  service   Service  @relation(fields: [serviceId], references: [id])
  user      User     @relation(fields: [userId], references: [id])
  vehicle   Vehicle  @relation(fields: [vehicleId], references: [id])

  @@index([date])
  @@index([status])
  @@map("appointments")
}

model Part {
  id           String                 @id @default(cuid())
  name         String
  description  String?
  partNumber   String                 @unique
  manufacturer String?
  category     String
  price        Float
  cost         Float
  stock        Int                    @default(0)
  minStock     Int                    @default(5)
  maxStock     Int                    @default(100)
  location     String?
  supplierId   String?
  createdBy    String?
  createdAt    DateTime               @default(now())
  updatedAt    DateTime               @updatedAt
  transactions InventoryTransaction[]
  supplier     Supplier?              @relation(fields: [supplierId], references: [id])
  services     ServicePart[]

  @@index([category])
  @@index([supplierId])
  @@index([createdBy])
}

model ServicePart {
  id        String  @id @default(cuid())
  serviceId String
  partId    String
  quantity  Int     @default(1)
  part      Part    @relation(fields: [partId], references: [id], onDelete: Cascade)
  service   Service @relation(fields: [serviceId], references: [id], onDelete: Cascade)

  @@unique([serviceId, partId])
}

model Supplier {
  id          String   @id @default(cuid())
  name        String
  contactName String?
  email       String?
  phone       String?
  address     String?
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt
  parts       Part[]
}

model InventoryTransaction {
  id         String          @id @default(cuid())
  partId     String
  type       TransactionType
  quantity   Int
  unitPrice  Float
  totalPrice Float
  reference  String?
  notes      String?
  createdAt  DateTime        @default(now())
  createdBy  String
  part       Part            @relation(fields: [partId], references: [id], onDelete: Cascade)

  @@index([partId])
  @@index([type])
}

enum Role {
  SUPER_ADMIN
  ADMIN
  MECHANIC
  RECEPTIONIST
  USER
}

enum TransactionType {
  PURCHASE
  SALE
  ADJUSTMENT
  RETURN
}
